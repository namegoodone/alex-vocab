<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Master AI - æè‡´æ’ç‰ˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„é«˜çº§æ„Ÿå­—ä½“æ— */
        body { 
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f3f4f6;
        }
        /* é€‰é¡¹æŒ‰é’®çš„åŸºç¡€ä¸åé¦ˆæ ·å¼ */
        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }
        .correct { background-color: #f0fdf4 !important; border-color: #22c55e !important; color: #15803d !important; font-weight: 600; }
        .wrong { background-color: #fef2f2 !important; border-color: #ef4444 !important; color: #b91c1c !important; }
        /* æè‡´å‘¼å¸æ„Ÿçš„åŠ è½½åŠ¨ç”» */
        .loader { border-top-color: #6366f1; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen py-12 px-4 flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white rounded-[2.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.05)] overflow-hidden border border-gray-50">

        <div class="bg-indigo-600 p-8 text-white flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-black tracking-tight italic">Vocab Master <span class="text-indigo-200">AI</span></h1>
                <p class="text-xs text-indigo-100 mt-1 opacity-80 font-medium tracking-widest uppercase">TEM-8 & GRE Dual Mode</p>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="fetchNewWords()" id="ai-gen-btn" class="bg-white/20 hover:bg-white/30 backdrop-blur-md px-6 py-2.5 rounded-2xl text-sm font-bold transition flex items-center gap-2 border border-white/10">
                    <span>AI æ‰©å……è¯åº“</span>
                </button>
                <button onclick="resetAll()" class="bg-red-500 hover:bg-red-400 p-2.5 rounded-xl transition shadow-lg shadow-red-900/20" title="é‡ç½®è¿›åº¦">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-px bg-gray-50 border-b border-gray-100">
            <div class="bg-white py-6 text-center">
                <p class="text-[11px] text-gray-400 uppercase font-black tracking-wider mb-1">å¾…å¤ä¹ </p>
                <p id="stat-review" class="text-3xl font-black text-indigo-600">0</p>
            </div>
            <div class="bg-white py-6 text-center">
                <p class="text-[11px] text-gray-400 uppercase font-black tracking-wider mb-1">å·²æŒæ¡</p>
                <p id="stat-mastered" class="text-3xl font-black text-emerald-500">0</p>
            </div>
            <div class="bg-white py-6 text-center">
                <p class="text-[11px] text-gray-400 uppercase font-black tracking-wider mb-1">æ€»è¯é‡</p>
                <p id="stat-total" class="text-3xl font-black text-gray-800">0</p>
            </div>
        </div>

        <div class="p-10 md:p-14">
            <div id="loading-overlay" class="hidden flex flex-col items-center py-20">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-100 h-16 w-16 mb-6"></div>
                <p class="text-indigo-600 font-bold text-lg">DeepSeek æ­£åœ¨è§£æè¯­æ–™åº“...</p>
            </div>

            <div id="quiz-container">
                <div class="flex items-center justify-between mb-10">
                    <span id="q-type" class="px-4 py-1.5 bg-orange-100 text-orange-700 text-[11px] font-black rounded-full tracking-wider">GRE MODE</span>
                    <span class="text-[11px] text-gray-300 font-bold tracking-widest">RETENTION: <span id="q-next" class="text-indigo-400">STAGE 0</span></span>
                </div>

                <h2 id="q-word" class="text-6xl md:text-7xl font-black text-gray-900 mb-8 tracking-tighter">------</h2>
                
                <div class="bg-indigo-50/50 p-7 rounded-[2rem] mb-12 border-l-8 border-indigo-500 shadow-inner">
                    <p id="q-sentence" class="text-gray-700 text-xl leading-relaxed italic font-medium">"..."</p>
                </div>

                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>

                <div id="feedback" class="mt-12 p-8 rounded-[2.5rem] hidden border-2 transition-all">
                    <div class="flex items-center gap-3 mb-6">
                        <span id="fb-icon" class="text-3xl"></span>
                        <p id="fb-text" class="text-2xl font-black"></p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-white/50 p-4 rounded-2xl">
                            <p class="text-[11px] text-indigo-400 font-black uppercase mb-2 tracking-widest">ä¸­æ–‡é‡Šä¹‰ / Meanings</p>
                            <p id="fb-cn" class="text-gray-800 text-lg font-bold"></p>
                        </div>
                        <div class="bg-white/50 p-4 rounded-2xl">
                            <p class="text-[11px] text-indigo-400 font-black uppercase mb-2 tracking-widest">English Definition</p>
                            <p id="fb-en" class="text-gray-600 text-base italic leading-relaxed"></p>
                        </div>
                    </div>

                    <button onclick="renderNext()" class="mt-10 w-full bg-indigo-600 text-white py-5 rounded-2xl font-black text-lg hover:bg-indigo-700 transition shadow-xl shadow-indigo-200 active:scale-95">
                        æŒæ¡äº†ï¼Œä¸‹ä¸€é¢˜
                    </button>
                </div>
            </div>

            <div id="empty-state" class="hidden text-center py-20">
                <div class="text-8xl mb-8">ğŸ¯</div>
                <h3 class="text-3xl font-black text-gray-900">é˜¶æ®µæ€§èƒœåˆ©ï¼</h3>
                <p class="text-gray-400 mt-3 text-lg">å½“å‰è¯åº“å·²å…¨éƒ¨å¤ä¹ å®Œæ¯•ï¼Œè¯·è¡¥å……æ–°è¯ã€‚</p>
                <button onclick="fetchNewWords()" class="mt-10 px-10 py-4 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 transition shadow-2xl">
                    è®© AI æ‰©å……è¯åº“
                </button>
            </div>
        </div>
    </div>

    <script>
        /** é…ç½® API **/
        const API_KEY = 'sk-0c7ad30471a84d39a9923603114041e3'; 
        const API_URL = 'https://api.deepseek.com/chat/completions';

        const baseWords = [
            { word: "Capricious", options: ["åå¤æ— å¸¸çš„", "åšå®šçš„", "æ…·æ…¨çš„", "æ²‰é»˜çš„"], answer: 0, type: "GRE", sentence: "The court's decision was ______, lacking any clear logical basis.", meaning_cn: "åå¤æ— å¸¸çš„ï¼›å˜å¹»è«æµ‹çš„", meaning_en: "Given to sudden and unaccountable changes of mood or behavior." }
        ];

        const INTERVALS = [0, 5, 30, 720, 1440, 2880, 5760, 10080];
        let customBank = JSON.parse(localStorage.getItem('deepseek_bank')) || [];
        let progress = JSON.parse(localStorage.getItem('vocab_progress')) || {};
        let currentQueue = [];
        let currentIndex = 0;

        function init() {
            buildQueue();
            updateStats();
            renderNext();
        }

        function buildQueue() {
            const allWords = [...baseWords, ...customBank];
            const now = Date.now();
            currentQueue = allWords.filter(w => {
                const stat = progress[w.word];
                if (!stat) return true;
                if (stat.level >= INTERVALS.length - 1) return false;
                return now >= stat.nextReview;
            }).sort(() => Math.random() - 0.5);
            currentIndex = 0;
        }

        async function fetchNewWords() {
            toggleLoading(true);
            const prompt = `ä½ æ˜¯ä¸€ä¸ªé«˜çº§è‹±è¯­è¯æ±‡ä¸“å®¶ï¼Œæ“…é•¿TEM-8å’ŒGREã€‚è¯·ç”Ÿæˆ5ä¸ªæå…·è¿·æƒ‘æ€§çš„å•è¯æµ‹è¯•ã€‚ä¸¥æ ¼è¿”å›JSONæ ¼å¼æ•°ç»„ã€‚å­—æ®µ: word, options(4ä¸ª), answer(0-3), type, sentence(ç”¨____), meaning_cn, meaning_enã€‚`;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{role: "system", content: "Output raw JSON array only."}, {role: "user", content: prompt}]
                    })
                });
                const data = await res.json();
                let text = data.choices[0].message.content.trim();
                const jsonMatch = text.match(/\[.*\]/s);
                const newWords = JSON.parse(jsonMatch[0]);
                customBank = [...customBank, ...newWords];
                localStorage.setItem('deepseek_bank', JSON.stringify(customBank));
                buildQueue();
                renderNext();
                updateStats();
            } catch (e) {
                alert("AI å‡ºé¢˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API é…ç½®æˆ–ç½‘ç»œã€‚");
            } finally {
                toggleLoading(false);
            }
        }

        function renderNext() {
            const container = document.getElementById('quiz-container');
            const empty = document.getElementById('empty-state');
            const feedback = document.getElementById('feedback');
            feedback.classList.add('hidden');
            if (currentIndex >= currentQueue.length) {
                container.classList.add('hidden');
                empty.classList.remove('hidden');
                updateStats();
                return;
            }
            container.classList.remove('hidden');
            empty.classList.add('hidden');
            const q = currentQueue[currentIndex];
            document.getElementById('q-word').innerText = q.word;
            document.getElementById('q-sentence').innerText = q.sentence;
            document.getElementById('q-type').innerText = q.type + " MODE";
            const stats = progress[q.word];
            document.getElementById('q-next').innerText = stats ? `STAGE ${stats.level}` : 'STAGE 0';

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-6 border-2 border-gray-100 rounded-[1.5rem] font-bold text-gray-700 bg-white text-lg";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(idx, btn);
                grid.appendChild(btn);
            });
        }

        function handleAnswer(idx, btn) {
            const q = currentQueue[currentIndex];
            const isCorrect = (idx === q.answer);
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach((b, i) => {
                b.disabled = true;
                if (i === q.answer) b.classList.add('correct');
                else if (i === idx) b.classList.add('wrong');
            });
            let stat = progress[q.word] || { level: 0, nextReview: 0 };
            if (isCorrect) stat.level = Math.min(stat.level + 1, INTERVALS.length - 1);
            else stat.level = Math.max(0, stat.level - 1);
            stat.nextReview = Date.now() + INTERVALS[stat.level] * 60 * 1000;
            progress[q.word] = stat;
            localStorage.setItem('vocab_progress', JSON.stringify(progress));
            
            const fb = document.getElementById('feedback');
            fb.classList.remove('hidden');
            fb.className = isCorrect ? "mt-12 p-8 rounded-[2.5rem] border-green-200 bg-green-50/30 block" : "mt-12 p-8 rounded-[2.5rem] border-red-200 bg-red-50/30 block";
            document.getElementById('fb-icon').innerText = isCorrect ? "âœ¨" : "ğŸ’¡";
            document.getElementById('fb-text').innerText = isCorrect ? "å¤ªæ£’äº†ï¼å®Œå…¨æ­£ç¡®" : "åˆ«ç°å¿ƒï¼Œè§£æå¦‚ä¸‹";
            document.getElementById('fb-text').className = isCorrect ? "text-2xl font-black text-emerald-700" : "text-2xl font-black text-red-700";
            document.getElementById('fb-cn').innerText = q.meaning_cn;
            document.getElementById('fb-en').innerText = q.meaning_en;
            currentIndex++;
            updateStats();
        }

        function updateStats() {
            const allWords = [...baseWords, ...customBank];
            document.getElementById('stat-total').innerText = allWords.length;
            let mastered = 0;
            Object.values(progress).forEach(p => { if(p.level >= INTERVALS.length - 1) mastered++; });
            document.getElementById('stat-mastered').innerText = mastered;
            const now = Date.now();
            const toRev = allWords.filter(w => {
                const s = progress[w.word];
                return !s || (s.level < INTERVALS.length - 1 && now >= s.nextReview);
            }).length;
            document.getElementById('stat-review').innerText = toRev;
        }

        function toggleLoading(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
            document.getElementById('quiz-container').classList.toggle('hidden', show);
            document.getElementById('ai-gen-btn').disabled = show;
        }

        function resetAll() {
            if(confirm("ç¡®å®šæ¸…é™¤æ‰€æœ‰è¿›åº¦å—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }
        init();
    </script>
</body>
</html>
