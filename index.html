<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Master AI - è§†è§‰ä¼˜åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ç³»ç»Ÿé»˜è®¤é«˜è´¨é‡é»‘ä½“ï¼Œç¡®ä¿æ¸²æŸ“æ¸…æ™° */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5; 
        }
        .option-btn { transition: all 0.2s ease; }
        .option-btn:hover:not(:disabled) { transform: translateY(-1px); border-color: #6366f1; background-color: #f5f7ff; }
        .correct { background-color: #f0fdf4 !important; border-color: #22c55e !important; color: #166534 !important; }
        .wrong { background-color: #fef2f2 !important; border-color: #ef4444 !important; color: #991b1b !important; }
        .loader { border-top-color: #6366f1; animation: spinner 1s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen py-12 px-4 flex items-center justify-center">

    <div id="app" class="w-full max-w-4xl bg-white rounded-[2rem] shadow-[0_30px_60px_-15px_rgba(0,0,0,0.1)] overflow-hidden border border-gray-100">

        <div class="bg-indigo-600 p-8 text-white flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">Vocab Master AI</h1>
                <p class="text-xs text-indigo-200 mt-1 uppercase tracking-widest font-semibold opacity-80">TEM-8 & GRE Dual Mode</p>
            </div>
            <div class="flex gap-3">
                <button onclick="fetchNewWords()" id="ai-gen-btn" class="bg-indigo-500/50 hover:bg-indigo-400 px-5 py-2.5 rounded-xl text-sm font-bold transition-all border border-white/10">
                    <span id="gen-text">AI æ‰©å……è¯åº“</span>
                </button>
                <button onclick="resetAll()" class="bg-red-500 hover:bg-red-400 p-2.5 rounded-xl transition shadow-lg shadow-red-500/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-px bg-gray-100">
            <div class="bg-white py-6 text-center">
                <p class="text-[10px] text-gray-400 uppercase font-bold mb-1 tracking-widest">å¾…å¤ä¹ </p>
                <p id="stat-review" class="text-3xl font-bold text-indigo-600">0</p>
            </div>
            <div class="bg-white py-6 text-center">
                <p class="text-[10px] text-gray-400 uppercase font-bold mb-1 tracking-widest">å·²æŒæ¡</p>
                <p id="stat-mastered" class="text-3xl font-bold text-emerald-500">0</p>
            </div>
            <div class="bg-white py-6 text-center">
                <p class="text-[10px] text-gray-400 uppercase font-bold mb-1 tracking-widest">æ€»è¯é‡</p>
                <p id="stat-total" class="text-3xl font-bold text-gray-700">0</p>
            </div>
        </div>

        <div class="p-10 md:p-14">
            <div id="loading-overlay" class="hidden flex flex-col items-center py-20">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-100 h-14 w-14 mb-4"></div>
                <p class="text-gray-500 font-bold">DeepSeek AI æ­£åœ¨ç”Ÿæˆé«˜è´¨é‡é¢˜ç›®...</p>
            </div>

            <div id="quiz-container">
                <div class="flex items-center justify-between mb-8">
                    <span id="q-type" class="px-3 py-1 bg-orange-50 text-orange-600 text-[10px] font-black rounded-lg border border-orange-100 uppercase tracking-wider">GRE</span>
                    <span class="text-[10px] text-gray-300 font-mono tracking-tighter uppercase">Retention: <span id="q-next" class="text-indigo-400">STAGE 0</span></span>
                </div>

                <h2 id="q-word" class="text-6xl font-bold text-gray-900 mb-8 tracking-normal">------</h2>
                
                <div class="bg-gray-50 p-6 rounded-2xl mb-12 border-l-4 border-indigo-500">
                    <p id="q-sentence" class="text-xl text-gray-600 italic leading-relaxed">"..."</p>
                </div>

                <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-5"></div>

                <div id="feedback" class="mt-12 p-8 rounded-[1.5rem] hidden border-2 border-dashed">
                    <div class="flex items-center gap-3 mb-6">
                        <span id="fb-icon" class="text-3xl"></span>
                        <p id="fb-text" class="text-2xl font-bold"></p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <p class="text-[10px] text-indigo-400 font-black uppercase mb-2 tracking-wider">ä¸­æ–‡é‡Šä¹‰</p>
                            <p id="fb-cn" class="text-gray-800 text-lg font-bold"></p>
                        </div>
                        <div>
                            <p class="text-[10px] text-indigo-400 font-black uppercase mb-2 tracking-wider">English Definition</p>
                            <p id="fb-en" class="text-gray-600 text-sm italic leading-relaxed"></p>
                        </div>
                    </div>

                    <button onclick="renderNext()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-xl shadow-indigo-100 active:scale-[0.98]">
                        æŒæ¡äº†ï¼Œä¸‹ä¸€é¢˜
                    </button>
                </div>
            </div>

            <div id="empty-state" class="hidden text-center py-16">
                <div class="text-7xl mb-6">ğŸ¯</div>
                <h3 class="text-2xl font-bold text-gray-800">å¤ä¹ å·²å°±ç»ª</h3>
                <p class="text-gray-400 mt-2">å¤ªæ£’äº†ï¼Œç›®å‰æ²¡æœ‰å¾…å¤ä¹ çš„è¯æ±‡ã€‚</p>
                <button onclick="fetchNewWords()" class="mt-8 px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition">
                    ç«‹å³è·å– AI æ–°è¯
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'sk-0c7ad30471a84d39a9923603114041e3';
        const API_URL = 'https://api.deepseek.com/chat/completions';

        const baseWords = [
            { word: "lugubrious", options: ["æ¬¢å¿«çš„", "å†—é•¿çš„", "æ‚²å“€çš„", "ç®€æ´çš„"], answer: 2, type: "TEM8", sentence: "The ____ melody of the cello perfectly captured the mood of the funeral scene.", meaning_cn: "æ‚²å“€çš„ï¼Œå¿§éƒçš„", meaning_en: "Looking or sounding sad and dismal." }
        ];

        const INTERVALS = [0, 5, 30, 720, 1440, 2880, 5760, 10080];
        let customBank = JSON.parse(localStorage.getItem('deepseek_bank')) || [];
        let progress = JSON.parse(localStorage.getItem('vocab_progress')) || {};
        let currentQueue = [];
        let currentIndex = 0;

        function init() { buildQueue(); updateStats(); renderNext(); }

        function buildQueue() {
            const allWords = [...baseWords, ...customBank];
            const now = Date.now();
            currentQueue = allWords.filter(w => {
                const stat = progress[w.word];
                if (!stat) return true;
                if (stat.level >= INTERVALS.length - 1) return false;
                return now >= stat.nextReview;
            }).sort(() => Math.random() - 0.5);
            currentIndex = 0;
        }

        async function fetchNewWords() {
            toggleLoading(true);
            const prompt = `ç”Ÿæˆ5ä¸ªTEM-8/GREå•è¯æµ‹è¯•ã€‚å­—æ®µ: word, options(4ä¸ª), answer(0-3), type, sentence(å«____), meaning_cn, meaning_enã€‚ä»…è¾“å‡º JSON æ•°ç»„ã€‚`;
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ model: "deepseek-chat", messages: [{role: "system", content: "You output JSON array only."}, {role: "user", content: prompt}] })
                });
                const data = await res.json();
                let text = data.choices[0].message.content.trim();
                const jsonMatch = text.match(/\[.*\]/s);
                const newWords = JSON.parse(jsonMatch[0]);
                customBank = [...customBank, ...newWords];
                localStorage.setItem('deepseek_bank', JSON.stringify(customBank));
                buildQueue(); renderNext(); updateStats();
            } catch (e) { alert("è·å–å¤±è´¥ï¼Œè¯·é‡è¯•"); } finally { toggleLoading(false); }
        }

        function renderNext() {
            const container = document.getElementById('quiz-container');
            const feedback = document.getElementById('feedback');
            const empty = document.getElementById('empty-state');
            feedback.classList.add('hidden');
            if (currentIndex >= currentQueue.length) { container.classList.add('hidden'); empty.classList.remove('hidden'); return; }
            container.classList.remove('hidden'); empty.classList.add('hidden');
            const q = currentQueue[currentIndex];
            document.getElementById('q-word').innerText = q.word;
            document.getElementById('q-sentence').innerText = q.sentence;
            document.getElementById('q-type').innerText = q.type;
            const stats = progress[q.word];
            document.getElementById('q-next').innerText = stats ? `STAGE ${stats.level}` : 'STAGE 0';
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-6 border-2 border-gray-100 rounded-2xl font-medium text-gray-700 bg-white hover:shadow-sm";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(idx, btn);
                grid.appendChild(btn);
            });
        }

        function handleAnswer(idx, btn) {
            const q = currentQueue[currentIndex];
            const isCorrect = (idx === q.answer);
            document.querySelectorAll('.option-btn').forEach((b, i) => {
                b.disabled = true;
                if (i === q.answer) b.classList.add('correct');
                else if (i === idx) b.classList.add('wrong');
            });
            let stat = progress[q.word] || { level: 0, nextReview: 0 };
            if (isCorrect) stat.level = Math.min(stat.level + 1, INTERVALS.length - 1);
            else stat.level = Math.max(0, stat.level - 1);
            stat.nextReview = Date.now() + INTERVALS[stat.level] * 60 * 1000;
            progress[q.word] = stat;
            localStorage.setItem('vocab_progress', JSON.stringify(progress));
            const fb = document.getElementById('feedback');
            fb.classList.remove('hidden');
            fb.className = isCorrect ? "mt-12 p-8 rounded-[1.5rem] border-emerald-100 bg-emerald-50/30 block" : "mt-12 p-8 rounded-[1.5rem] border-red-100 bg-red-50/30 block";
            document.getElementById('fb-icon').innerText = isCorrect ? "âœ¨" : "ğŸ’¡";
            document.getElementById('fb-text').innerText = isCorrect ? "æ­£ç¡®ï¼" : "è§£æ";
            document.getElementById('fb-cn').innerText = q.meaning_cn;
            document.getElementById('fb-en').innerText = q.meaning_en;
            currentIndex++; updateStats();
        }

        function updateStats() {
            const allWords = [...baseWords, ...customBank];
            document.getElementById('stat-total').innerText = allWords.length;
            let mastered = Object.values(progress).filter(p => p.level >= INTERVALS.length - 1).length;
            document.getElementById('stat-mastered').innerText = mastered;
            const toRev = allWords.filter(w => { const s = progress[w.word]; return !s || (s.level < INTERVALS.length - 1 && Date.now() >= s.nextReview); }).length;
            document.getElementById('stat-review').innerText = toRev;
        }

        function toggleLoading(show) { document.getElementById('loading-overlay').classList.toggle('hidden', !show); document.getElementById('quiz-container').classList.toggle('hidden', show); }
        function resetAll() { if(confirm("é‡ç½®æ‰€æœ‰è¿›åº¦ï¼Ÿ")) { localStorage.clear(); location.reload(); } }
        init();
    </script>
</body>
</html>
